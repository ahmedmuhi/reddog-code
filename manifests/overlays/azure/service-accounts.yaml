# Azure Workload Identity ServiceAccount annotations
# These ServiceAccounts are configured for Azure Workload Identity federation
# Prerequisites:
# 1. User-assigned Managed Identities must be created for each service
# 2. Federate Managed Identities with the respective ServiceAccount
# 3. Grant appropriate permissions (e.g., CosmosDB, Blob Storage access)
# 4. Update <client-id> placeholders with actual Managed Identity client IDs

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: order-service
  namespace: reddog-retail
  labels:
    app.kubernetes.io/name: order-service
    app.kubernetes.io/component: backend
    app.kubernetes.io/environment: azure
  annotations:
    azure.workload.identity/client-id: "<order-service-managed-identity-client-id>"
    azure.workload.identity/tenant-id: "<azure-tenant-id>"
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: make-line-service
  namespace: reddog-retail
  labels:
    app.kubernetes.io/name: make-line-service
    app.kubernetes.io/component: backend
    app.kubernetes.io/environment: azure
  annotations:
    azure.workload.identity/client-id: "<make-line-service-managed-identity-client-id>"
    azure.workload.identity/tenant-id: "<azure-tenant-id>"
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: loyalty-service
  namespace: reddog-retail
  labels:
    app.kubernetes.io/name: loyalty-service
    app.kubernetes.io/component: backend
    app.kubernetes.io/environment: azure
  annotations:
    azure.workload.identity/client-id: "<loyalty-service-managed-identity-client-id>"
    azure.workload.identity/tenant-id: "<azure-tenant-id>"
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: accounting-service
  namespace: reddog-retail
  labels:
    app.kubernetes.io/name: accounting-service
    app.kubernetes.io/component: backend
    app.kubernetes.io/environment: azure
  annotations:
    azure.workload.identity/client-id: "<accounting-service-managed-identity-client-id>"
    azure.workload.identity/tenant-id: "<azure-tenant-id>"
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: receipt-generation-service
  namespace: reddog-retail
  labels:
    app.kubernetes.io/name: receipt-generation-service
    app.kubernetes.io/component: backend
    app.kubernetes.io/environment: azure
  annotations:
    azure.workload.identity/client-id: "<receipt-service-managed-identity-client-id>"
    azure.workload.identity/tenant-id: "<azure-tenant-id>"
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: virtual-worker
  namespace: reddog-retail
  labels:
    app.kubernetes.io/name: virtual-worker
    app.kubernetes.io/component: simulator
    app.kubernetes.io/environment: azure
  annotations:
    azure.workload.identity/client-id: "<virtual-worker-managed-identity-client-id>"
    azure.workload.identity/tenant-id: "<azure-tenant-id>"
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: virtual-customers
  namespace: reddog-retail
  labels:
    app.kubernetes.io/name: virtual-customers
    app.kubernetes.io/component: simulator
    app.kubernetes.io/environment: azure
  annotations:
    azure.workload.identity/client-id: "<virtual-customers-managed-identity-client-id>"
    azure.workload.identity/tenant-id: "<azure-tenant-id>"
